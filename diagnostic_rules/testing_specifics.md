## 1. 台架模拟 / 实车测试策略

### 1.1 测试层次

1. **软件在环（SIL）**
   - 使用 ECU 仿真器（软件模拟，可基于 recorded traces）；
   - 即使无真实硬件，也可对完整诊断流程做初步验证。

2. **硬件在环（HIL）/台架测试**
   - 接入真实 VCI（RP1210 适配设备）；
   - 使用 ECU 台架（Bench ECU）；
   - 重点验证：
     - 时序（P2 / P2* 超时）；
     - 总线负荷；
     - 多 ECU / 多路诊断场景。

3. **实车测试**
   - 在符合安全要求环境下进行（封闭道路/台架驱动轮）；
   - 验证与整车网络交互可能带来的副作用。

### 1.2 关键测试对象

- **协议行为**：
  - UDS 服务集支持情况；
  - NRC 处理；
  - 0x78 Pending 行为在实车下的表现（不同 ECU 延迟不同）。

- **安全敏感操作**：
  - 刷写中断行为（断电、拔线）；
  - 车辆处于不同工况（点火开/关、发动机转速）时，敏感操作是否被禁止或给出明确告警。

- **稳定性/长时间运行**：
  - 周期性读取数据流 1 小时以上；
  - 连续刷写多 ECU / 多次循环，检查是否出现资源泄露或异常崩溃。

---

## 2. 典型集成场景（建议必须覆盖）

1. **DTC 读取/清除流程**
   - 建立会话 → 读取 DTC → 校验解析结果 → 清除 DTC → 再次读取验证；
   - 同时验证错误路径（ECU 返回 NRC、通信失败等）。

2. **数据流读取**
   - 启动会话 → 读取数据流 → 将原始数据转换为物理值；
   - 验证与预期物理单位/精度一致（对应 `data` 中配置）。

3. **安全访问 (0x27)**
   - 多轮 Seed/Key 交互；
   - 处理 NRC（如权限不足、尝试次数超限）；
   - 成功后验证后续敏感服务（如编码/刷写）是否被放行。

4. **刷写/编码基础流程**（如启用）
   - 进入编程会话 → 安全验证 → 传输数据块（可用小测试映像）→ 重启 ECU；
   - 验证断电/中断失败路径下的保护行为。

---

## 3. 性能指标（Diagnostic Context）

具体数值根据 OEM 要求和项目现实可调整：

- **UDS 单次请求平均往返时间**（在无总线拥堵、仅连接目标 ECU 场景）：
  - 普通服务（如 0x22）：典型 < 200 ms；
  - 大负载读/写：取决于 ECU 设计，需记录实测值。

- **扫描全车所有 ECU 的 DTC 所需时间**（在指定车型上测量，作为基准指标）。

---

## 4. 稳定性 / 资源测试

- **长时间运行测试**：
  - 连续运行周期数据流读取 ≥ 1 小时；
- **高负荷场景测试**：
  - 多 ECU 并行诊断（如支持）；
  - 高频请求（测试应用端防抖与 ECU 防护机制）。
